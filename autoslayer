local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

local HitboxActive = false
local hitboxConnection = nil
local originalSizes = {}

-- ================== CONFIGURA√á√ïES ==================
local config = {
    hitboxSize = 20,
    npcName = "GenericSlayer",  -- Nome do NPC
    transparency = 0.7,  -- Transpar√™ncia da hitbox visual
}

-- ================== GUI ==================
local gui = Instance.new("ScreenGui")
gui.Name = "HitboxGui"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 180)
frame.Position = UDim2.new(0.5, -100, 0.5, -90)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Parent = gui
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
title.Text = "üéØ Hitbox Expander"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 14
title.Font = Enum.Font.GothamBold
title.Parent = frame
Instance.new("UICorner", title).CornerRadius = UDim.new(0, 8)

-- Input de tamanho
local sizeLabel = Instance.new("TextLabel")
sizeLabel.Size = UDim2.new(1, -20, 0, 20)
sizeLabel.Position = UDim2.new(0, 10, 0, 40)
sizeLabel.BackgroundTransparency = 1
sizeLabel.Text = "Tamanho da Hitbox:"
sizeLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
sizeLabel.TextSize = 12
sizeLabel.Font = Enum.Font.Gotham
sizeLabel.TextXAlignment = Enum.TextXAlignment.Left
sizeLabel.Parent = frame

local sizeInput = Instance.new("TextBox")
sizeInput.Size = UDim2.new(1, -20, 0, 30)
sizeInput.Position = UDim2.new(0, 10, 0, 65)
sizeInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
sizeInput.PlaceholderText = "Tamanho (ex: 20)"
sizeInput.Text = tostring(config.hitboxSize)
sizeInput.TextColor3 = Color3.fromRGB(100, 255, 100)
sizeInput.TextSize = 14
sizeInput.Font = Enum.Font.GothamBold
sizeInput.ClearTextOnFocus = false
sizeInput.Parent = frame
Instance.new("UICorner", sizeInput).CornerRadius = UDim.new(0, 6)

-- Bot√£o toggle
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(1, -20, 0, 35)
toggleBtn.Position = UDim2.new(0, 10, 0, 105)
toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
toggleBtn.Text = "ATIVAR HITBOX"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.TextSize = 14
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.Parent = frame
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 6)

-- Bot√£o de debug/copiar info
local debugBtn = Instance.new("TextButton")
debugBtn.Size = UDim2.new(1, -20, 0, 30)
debugBtn.Position = UDim2.new(0, 10, 0, 145)
debugBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 200)
debugBtn.Text = "üìã Copiar Info Debug"
debugBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
debugBtn.TextSize = 12
debugBtn.Font = Enum.Font.GothamBold
debugBtn.Parent = frame
Instance.new("UICorner", debugBtn).CornerRadius = UDim.new(0, 6)

-- ================== FUN√á√ïES ==================
local function getRoot(model)
    return model:FindFirstChild("HumanoidRootPart") 
        or model:FindFirstChild("Torso") 
        or model:FindFirstChild("UpperTorso")
end

local function findAllNPCs()
    local npcs = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj.Name == config.npcName then
            table.insert(npcs, obj)
        end
    end
    return npcs
end

local function expandHitbox(npc)
    local root = getRoot(npc)
    if not root then return false end
    
    -- Salva tamanho original
    if not originalSizes[root] then
        originalSizes[root] = root.Size
    end
    
    -- Expande hitbox
    local size = tonumber(sizeInput.Text) or config.hitboxSize
    root.Size = Vector3.new(size, size, size)
    root.Transparency = config.transparency
    root.CanCollide = false
    root.Massless = true
    
    -- Adiciona visual (box verde)
    if not root:FindFirstChild("HitboxVisual") then
        local visual = Instance.new("SelectionBox")
        visual.Name = "HitboxVisual"
        visual.Adornee = root
        visual.Color3 = Color3.fromRGB(0, 255, 0)
        visual.LineThickness = 0.05
        visual.Transparency = 0.5
        visual.Parent = root
    end
    
    return true
end

local function restoreHitbox(npc)
    local root = getRoot(npc)
    if not root then return end
    
    -- Restaura tamanho original
    if originalSizes[root] then
        root.Size = originalSizes[root]
        root.Transparency = 0
    end
    
    -- Remove visual
    local visual = root:FindFirstChild("HitboxVisual")
    if visual then
        visual:Destroy()
    end
end

local function startHitbox()
    hitboxConnection = RunService.Heartbeat:Connect(function()
        if not HitboxActive then return end
        
        local npcs = findAllNPCs()
        for _, npc in ipairs(npcs) do
            expandHitbox(npc)
        end
    end)
end

local function stopHitbox()
    if hitboxConnection then
        hitboxConnection:Disconnect()
        hitboxConnection = nil
    end
    
    -- Restaura todos os NPCs
    local npcs = findAllNPCs()
    for _, npc in ipairs(npcs) do
        restoreHitbox(npc)
    end
    
    originalSizes = {}
end

local function getDebugInfo()
    local npcs = findAllNPCs()
    local info = {
        "========== DEBUG INFO ==========",
        "NPCs encontrados: " .. #npcs,
        "Nome procurado: " .. config.npcName,
        "",
        "Workspace children:",
    }
    
    -- Lista todos os modelos no workspace
    local models = {}
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("Model") then
            table.insert(models, obj.Name)
        end
    end
    table.insert(info, "Total de modelos: " .. #models)
    table.insert(info, "Nomes: " .. table.concat(models, ", "))
    table.insert(info, "")
    
    -- Info de cada NPC encontrado
    for i, npc in ipairs(npcs) do
        table.insert(info, "NPC #" .. i .. ":")
        table.insert(info, "  Nome: " .. npc.Name)
        table.insert(info, "  Parent: " .. tostring(npc.Parent))
        
        local root = getRoot(npc)
        if root then
            table.insert(info, "  Root: " .. root.Name)
            table.insert(info, "  Size: " .. tostring(root.Size))
            table.insert(info, "  Pos: " .. tostring(root.Position))
        else
            table.insert(info, "  Root: N√ÉO ENCONTRADO")
        end
        
        -- Lista todas as partes
        local parts = {}
        for _, child in ipairs(npc:GetChildren()) do
            if child:IsA("BasePart") then
                table.insert(parts, child.Name)
            end
        end
        table.insert(info, "  Partes: " .. table.concat(parts, ", "))
        table.insert(info, "")
    end
    
    table.insert(info, "================================")
    return table.concat(info, "\n")
end

-- ================== EVENTOS ==================
toggleBtn.MouseButton1Click:Connect(function()
    HitboxActive = not HitboxActive
    
    if HitboxActive then
        toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        toggleBtn.Text = "DESATIVAR HITBOX"
        startHitbox()
        print("Hitbox ativada!")
    else
        toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        toggleBtn.Text = "ATIVAR HITBOX"
        stopHitbox()
        print("Hitbox desativada!")
    end
end)

debugBtn.MouseButton1Click:Connect(function()
    local info = getDebugInfo()
    setclipboard(info)
    print(info)
    
    debugBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    debugBtn.Text = "‚úì Copiado!"
    task.wait(1.5)
    debugBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 200)
    debugBtn.Text = "üìã Copiar Info Debug"
end)

sizeInput.FocusLost:Connect(function()
    local newSize = tonumber(sizeInput.Text)
    if newSize and newSize > 0 then
        config.hitboxSize = newSize
        print("Tamanho da hitbox atualizado para:", newSize)
    else
        sizeInput.Text = tostring(config.hitboxSize)
    end
end)

print("Hitbox Expander carregado!")
print("Clique em 'Copiar Info Debug' se n√£o funcionar!")
